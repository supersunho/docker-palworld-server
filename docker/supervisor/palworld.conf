[supervisord]
nodaemon=true
user=root
logfile=/var/log/palworld/supervisord.log
pidfile=/var/run/supervisord.pid

[program:palworld-server]
command=python -m src.server_manager
directory=/app
user=palworld
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/var/log/palworld/server.log
stderr_logfile=/var/log/palworld/server_error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile_backups=5
environment=PYTHONPATH="/app/src",PYTHONUNBUFFERED="1"
priority=100

[program:health-monitor]
command=python -m src.utils.health_manager
directory=/app
user=palworld
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/var/log/palworld/health.log
stderr_logfile=/var/log/palworld/health_error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
environment=PYTHONPATH="/app/src",PYTHONUNBUFFERED="1"
priority=200

[program:backup-scheduler]
command=/bin/bash -c 'if [[ "${BACKUP_ENABLED:-true}" == "true" ]]; then exec python -m src.backup.backup_manager; else echo "Backup disabled, sleeping..."; sleep infinity; fi'
directory=/app
user=palworld
autostart=true
autorestart=false
startretries=1
startsecs=5
stdout_logfile=/var/log/palworld/backup.log
stderr_logfile=/var/log/palworld/backup_error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
environment=PYTHONPATH="/app/src",PYTHONUNBUFFERED="1"
priority=300

[group:palworld]
programs=palworld-server,health-monitor,backup-scheduler
priority=999

[eventlistener:stdout]
command=supervisor_stdout
buffer_size=100
events=PROCESS_LOG
result_handler=supervisor_stdout:event_handler

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
